<script type="x/template" id="vue-blog-load-more-articles">

    <div class="blog-load-more">
        <button v-if="page < lastPageNumber" class="btn blog-btn-load-more" @click="loadMore()" :disabled="isLoading" > Load more</button>
    </div>

</script>
<script type="text/javascript">
    Vue.component('blog-load-more-articles', {

        delimiters: ['${', '}'],

        props: {
            currentPage: String,
            lastPageNumber: String,
            categoryId: String,
            itemsPerPage: String,
            filters: String
        },

        created: function() {
            var _this = this;
            this.$options.template = '#vue-blog-load-more-articles';
            this.page = this.currentPage;

            $.each( JSON.parse(this.filters), function( key, value ) {
                _this.filtersString += '&' + key + '=' + value;
            });
        },

        data: function () {
            return {
                page: 0,
                filtersString: '',
                isLoading: false
            };
        },

        methods: {
            loadMore: function() {
                var _this = this;
                this.isLoading = true;

                $.ajax({
                    type: "GET",
                    url: '/blog/articles/' + Number(this.categoryId) + '?page=' + (Number(this.page) + 1) + '&itemsPerPage=' + this.itemsPerPage + this.filtersString,
                    contentType: "application/json; charset=utf-8",
                    success: function(data)
                    {
                        _this.page ++;
                        $('#blog-posts').append('<div id="blog-page-' + _this.page + '">'+ data +'</div>');
                    },
                    error: function (){
                    },
                    complete: function(){
                        _this.isLoading = false;
                    }
                })

                //
                // fetch('/blog/articles/5555555?page=1&itemsPerPage=50', {
                //     method: 'GET',
                //     credentials: 'include',
                //     headers: {
                //         "Content-Type": "application/json; charset=utf-8",
                //     }
                // }).then(function(response) {
                //
                //     console.log(response);
                //
                //     $('#blog-posts').append('<div class="WAHWAHWA">'+ response +'</div>');
                //
                // }).then(function(data) {
                //
                //     console.log(data);
                //
                //     $('#blog-posts').append('<div class="WAHWAHWA">'+ data +'</div>');
                //
                // }).then(function(){
                //     _this.isLoading = false
                // }).catch(function(error){
                //     console.log(error);
                // });

            }
        }
    });
</script>